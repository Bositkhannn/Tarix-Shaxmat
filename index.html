<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Strategiya — Bilim Shaxmati</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Orbitron:wght@400;700;900&family=Nunito:wght@400;700;800;900&family=Playfair+Display:wght@400;700;900&family=Josefin+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>

/* ===========================
   THEME SYSTEM (unchanged)
   =========================== */

/* --- THEME 1: OLTIN KLASSIKA (dark gold) --- */
[data-theme="klassika"] {
  --bg: #0d0f14;
  --surface: #13161e;
  --surface2: #1a1e28;
  --accent: #c9a84c;
  --accent2: #e8c97a;
  --accent-dim: rgba(201,168,76,0.15);
  --p1: #c0392b;
  --p2: #2471a3;
  --p1-light: rgba(192,57,43,0.35);
  --p2-light: rgba(36,113,163,0.35);
  --neutral: #2a2e3a;
  --text: #e8dcc8;
  --text-dim: #8a7d6a;
  --border: rgba(201,168,76,0.22);
  --modal-bg: rgba(0,0,0,0.88);
  --board-gap: #0d0f14;
  --success: #27ae60;
  --fail: #c0392b;
  --font-title: 'Cinzel', serif;
  --font-body: 'Crimson Text', Georgia, serif;
  --radius: 3px;
  --board-radius: 2px;
}

/* --- THEME 2: YASHIL AKADEMIYA (light academic) --- */
[data-theme="akademiya"] {
  --bg: #f4f0e6;
  --surface: #fffdf6;
  --surface2: #f0ead8;
  --accent: #2d6a2d;
  --accent2: #4a9e4a;
  --accent-dim: rgba(45,106,45,0.12);
  --p1: #8b1a1a;
  --p2: #1a3d6b;
  --p1-light: rgba(139,26,26,0.18);
  --p2-light: rgba(26,61,107,0.18);
  --neutral: #ddd5c0;
  --text: #2a1f0e;
  --text-dim: #7a6a4a;
  --border: rgba(45,106,45,0.25);
  --modal-bg: rgba(20,12,0,0.75);
  --board-gap: #c8bfa8;
  --success: #1e6b1e;
  --fail: #8b1a1a;
  --font-title: 'Playfair Display', serif;
  --font-body: 'Crimson Text', Georgia, serif;
  --radius: 4px;
  --board-radius: 2px;
}

/* --- THEME 3: KIBERFAZO (neon cyber) --- */
[data-theme="kiberfazo"] {
  --bg: #050812;
  --surface: #080d1e;
  --surface2: #0c1228;
  --accent: #00f5ff;
  --accent2: #7b2fff;
  --accent-dim: rgba(0,245,255,0.1);
  --p1: #ff2d6b;
  --p2: #00c3ff;
  --p1-light: rgba(255,45,107,0.25);
  --p2-light: rgba(0,195,255,0.25);
  --neutral: #0f1530;
  --text: #c8e6ff;
  --text-dim: #4a7090;
  --border: rgba(0,245,255,0.2);
  --modal-bg: rgba(0,5,20,0.95);
  --board-gap: #050812;
  --success: #00ff88;
  --fail: #ff2d6b;
  --font-title: 'Orbitron', monospace;
  --font-body: 'Josefin Sans', sans-serif;
  --radius: 2px;
  --board-radius: 0px;
}

/* --- THEME 4: QUMLI CHO'L (warm desert) --- */
[data-theme="chol"] {
  --bg: #1e1208;
  --surface: #2a1a0a;
  --surface2: #352210;
  --accent: #e8913a;
  --accent2: #f5c060;
  --accent-dim: rgba(232,145,58,0.15);
  --p1: #c44b1b;
  --p2: #3a7a4a;
  --p1-light: rgba(196,75,27,0.3);
  --p2-light: rgba(58,122,74,0.3);
  --neutral: #3a2814;
  --text: #f2ddb8;
  --text-dim: #9a7a50;
  --border: rgba(232,145,58,0.25);
  --modal-bg: rgba(10,5,0,0.9);
  --board-gap: #1e1208;
  --success: #3a7a4a;
  --fail: #c44b1b;
  --font-title: 'Cinzel', serif;
  --font-body: 'Josefin Sans', sans-serif;
  --radius: 1px;
  --board-radius: 0px;
}

/* --- THEME 5: RANG-BARANG (colorful kids) --- */
[data-theme="rangbarang"] {
  --bg: #1a0a3d;
  --surface: #231452;
  --surface2: #2e1a6a;
  --accent: #ffdd00;
  --accent2: #ff9f1c;
  --accent-dim: rgba(255,221,0,0.15);
  --p1: #ff4757;
  --p2: #2ed573;
  --p1-light: rgba(255,71,87,0.3);
  --p2-light: rgba(46,213,115,0.3);
  --neutral: #342070;
  --text: #ffffff;
  --text-dim: #a080d0;
  --border: rgba(255,221,0,0.25);
  --modal-bg: rgba(10,0,40,0.92);
  --board-gap: #120730;
  --success: #2ed573;
  --fail: #ff4757;
  --font-title: 'Nunito', sans-serif;
  --font-body: 'Nunito', sans-serif;
  --radius: 12px;
  --board-radius: 8px;
}

/* ===========================
   BASE STYLES
   =========================== */
* { margin:0; padding:0; box-sizing:border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-body);
  min-height: 100vh;
  overflow-x: hidden;
  transition: background 0.4s, color 0.4s;
}

/* Ambient backgrounds per theme */
[data-theme="klassika"] body::before {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
  background:
    radial-gradient(ellipse 60% 40% at 20% 50%, rgba(201,168,76,0.04) 0%, transparent 60%),
    radial-gradient(ellipse 60% 40% at 80% 50%, rgba(36,113,163,0.04) 0%, transparent 60%);
}
[data-theme="kiberfazo"] body::before {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
  background:
    radial-gradient(ellipse 50% 60% at 10% 20%, rgba(0,245,255,0.06) 0%, transparent 50%),
    radial-gradient(ellipse 50% 60% at 90% 80%, rgba(123,47,255,0.08) 0%, transparent 50%);
}
[data-theme="rangbarang"] body::before {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
  background:
    radial-gradient(ellipse 60% 50% at 30% 20%, rgba(255,71,87,0.08) 0%, transparent 50%),
    radial-gradient(ellipse 60% 50% at 70% 80%, rgba(46,213,115,0.08) 0%, transparent 50%),
    radial-gradient(ellipse 40% 40% at 50% 50%, rgba(255,221,0,0.04) 0%, transparent 50%);
}

.screen { display:none; position:relative; z-index:1; }
.screen.active { display:flex; }

/* ===========================
   THEME SWITCHER
   =========================== */
.theme-switcher {
  display: flex;
  gap: 8px;
  justify-content: center;
  margin-bottom: 32px;
  flex-wrap: wrap;
}
.theme-dot {
  width: 36px; height: 36px;
  border-radius: 50%;
  cursor: pointer;
  border: 3px solid transparent;
  transition: all 0.2s;
  position: relative;
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem;
}
.theme-dot:hover { transform: scale(1.15); }
.theme-dot.active { border-color: white; box-shadow: 0 0 12px rgba(255,255,255,0.4); transform: scale(1.1); }
.theme-dot[data-t="klassika"] { background: linear-gradient(135deg, #0d0f14 50%, #c9a84c 50%); }
.theme-dot[data-t="akademiya"] { background: linear-gradient(135deg, #f4f0e6 50%, #2d6a2d 50%); }
.theme-dot[data-t="kiberfazo"] { background: linear-gradient(135deg, #050812 50%, #00f5ff 50%); }
.theme-dot[data-t="chol"] { background: linear-gradient(135deg, #1e1208 50%, #e8913a 50%); }
.theme-dot[data-t="rangbarang"] { background: linear-gradient(135deg, #1a0a3d 50%, #ffdd00 50%); }

.theme-label {
  font-family: var(--font-title);
  font-size: 0.6rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--text-dim);
  text-align: center;
  margin-top: 4px;
}
.theme-item { display: flex; flex-direction: column; align-items: center; }

/* ===========================
   SETUP SCREEN
   =========================== */
#setup-screen {
  min-height:100vh;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:40px 20px;
}

.logo { text-align:center; margin-bottom:36px; }
.logo-title {
  font-family: var(--font-title);
  font-size:clamp(2rem, 6vw, 3.8rem);
  font-weight:900;
  letter-spacing:0.12em;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  background-clip: text;
}
[data-theme="kiberfazo"] .logo-title {
  text-shadow: none;
  filter: drop-shadow(0 0 20px rgba(0,245,255,0.5));
}
[data-theme="rangbarang"] .logo-title {
  font-size: clamp(2.2rem, 7vw, 4.2rem);
  font-weight: 900;
}
.logo-subtitle {
  font-family: var(--font-body);
  font-size:0.95rem;
  color:var(--text-dim);
  letter-spacing:0.18em;
  text-transform:uppercase;
  margin-top:8px;
}
.logo-line {
  width:200px; height:1px;
  background: linear-gradient(90deg, transparent, var(--accent), transparent);
  margin:14px auto;
}
[data-theme="kiberfazo"] .logo-line {
  height: 2px;
  box-shadow: 0 0 8px var(--accent);
}

.setup-card {
  background: var(--surface);
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:36px;
  width:100%;
  max-width:640px;
  position:relative;
  transition: all 0.3s;
}
.setup-card::before {
  content:'';
  position:absolute;
  top:-1px; left:10%; right:10%;
  height:2px;
  background: linear-gradient(90deg, transparent, var(--accent), transparent);
}
[data-theme="kiberfazo"] .setup-card {
  box-shadow: 0 0 40px rgba(0,245,255,0.06), inset 0 0 60px rgba(0,245,255,0.02);
}
[data-theme="rangbarang"] .setup-card {
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
}

.setup-section { margin-bottom:24px; }
.setup-label {
  font-family: var(--font-title);
  font-size:0.7rem;
  letter-spacing:0.2em;
  text-transform:uppercase;
  color:var(--accent);
  margin-bottom:12px;
  display:block;
}
.player-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.player-input {
  background: var(--surface2);
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:12px 16px;
  color:var(--text);
  font-family: var(--font-body);
  font-size:1.05rem;
  width:100%;
  transition:border-color 0.2s, box-shadow 0.2s;
}
.player-input:focus { outline:none; border-color:var(--accent); box-shadow: 0 0 0 3px var(--accent-dim); }
.player-input::placeholder { color:var(--text-dim); }
.player-input.p1 { border-left:3px solid var(--p1); }
.player-input.p2 { border-left:3px solid var(--p2); }

.time-options { display:flex; gap:10px; flex-wrap:wrap; }
.time-btn {
  flex:1; min-width:72px;
  padding:10px;
  background: var(--surface2);
  border:1px solid var(--border);
  border-radius: var(--radius);
  color:var(--text-dim);
  font-family: var(--font-title);
  font-size:0.8rem;
  letter-spacing:0.06em;
  cursor:pointer;
  transition:all 0.2s;
  text-align:center;
}
.time-btn:hover { border-color:var(--accent); color:var(--accent); }
.time-btn.selected {
  background:var(--accent-dim);
  border-color:var(--accent);
  color:var(--accent2);
}

.start-btn {
  width:100%;
  padding:17px;
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 50%, var(--accent) 100%);
  border:none;
  border-radius: var(--radius);
  color: var(--bg);
  font-family: var(--font-title);
  font-size:1rem;
  font-weight:700;
  letter-spacing:0.15em;
  text-transform:uppercase;
  cursor:pointer;
  transition:all 0.3s;
  position:relative;
  overflow:hidden;
}
.start-btn::before {
  content:'';
  position:absolute; inset:0;
  background:linear-gradient(135deg, transparent 30%, rgba(255,255,255,0.25) 50%, transparent 70%);
  transform:translateX(-100%);
  transition:transform 0.5s;
}
.start-btn:hover::before { transform:translateX(100%); }
.start-btn:hover { box-shadow:0 0 30px var(--accent-dim), 0 4px 20px rgba(0,0,0,0.3); transform: translateY(-1px); }
[data-theme="kiberfazo"] .start-btn { box-shadow: 0 0 20px rgba(0,245,255,0.3); }
[data-theme="rangbarang"] .start-btn { font-size: 1.1rem; }

/* ===========================
   GAME SCREEN
   =========================== */
#game-screen {
  min-height:100vh;
  flex-direction:column;
  align-items:center;
  padding:20px;
  gap:14px;
}

.game-header {
  width:100%;
  max-width:900px;
  display:grid;
  grid-template-columns:1fr auto 1fr;
  align-items:center;
  gap:14px;
}

.player-panel {
  padding:13px 18px;
  border-radius: var(--radius);
  transition:all 0.3s;
}
.player-panel.p1 {
  background: var(--p1-light);
  border:1px solid rgba(var(--p1-rgb, 192,57,43),0.3);
  border-left:3px solid var(--p1);
}
.player-panel.p2 {
  background: var(--p2-light);
  border:1px solid rgba(var(--p2-rgb, 36,113,163),0.3);
  border-right:3px solid var(--p2);
  text-align:right;
}
.player-panel.p1.active { border-left-color:var(--accent); box-shadow:0 0 20px var(--accent-dim); }
.player-panel.p2.active { border-right-color:var(--accent); box-shadow:0 0 20px var(--accent-dim); }
[data-theme="kiberfazo"] .player-panel.p1.active { box-shadow: 0 0 25px rgba(255,45,107,0.25); }
[data-theme="kiberfazo"] .player-panel.p2.active { box-shadow: 0 0 25px rgba(0,195,255,0.25); }

.player-name { font-family: var(--font-title); font-size:0.9rem; font-weight:600; color:var(--text); }
.player-score { font-size:2rem; font-weight:700; font-family: var(--font-title); line-height:1; }
.p1 .player-score { color:var(--p1); }
.p2 .player-score { color:var(--p2); }
.player-label { font-size:0.65rem; letter-spacing:0.12em; text-transform:uppercase; color:var(--text-dim); }

.timer-display { text-align:center; }
.timer-value {
  font-family: var(--font-title);
  font-size:2rem; font-weight:700;
  color:var(--accent);
  letter-spacing:0.05em;
}
[data-theme="kiberfazo"] .timer-value { text-shadow: 0 0 15px var(--accent); }
.timer-label { font-size:0.65rem; letter-spacing:0.2em; text-transform:uppercase; color:var(--text-dim); margin-top:2px; }
.turn-indicator { font-family: var(--font-title); font-size:0.68rem; letter-spacing:0.1em; color:var(--accent); text-transform:uppercase; margin-top:4px; }

/* ===========================
   BOARD
   =========================== */
.board-container {
  padding:24px;
  background: var(--surface);
  border:1px solid var(--border);
  border-radius: var(--radius);
  transition: all 0.3s;
}
[data-theme="kiberfazo"] .board-container {
  box-shadow: 0 0 40px rgba(0,245,255,0.08);
  border-color: rgba(0,245,255,0.25);
}
[data-theme="rangbarang"] .board-container {
  box-shadow: 0 8px 40px rgba(0,0,0,0.5);
}

#chess-board {
  display:grid;
  grid-template-columns:repeat(8, 1fr);
  gap:2px;
  background: var(--board-gap);
  padding:2px;
  border-radius: var(--board-radius);
}
[data-theme="kiberfazo"] #chess-board { gap: 1px; }
[data-theme="rangbarang"] #chess-board { gap: 3px; border-radius: 10px; }

.cell {
  width: clamp(48px, 7.5vw, 72px);
  height: clamp(48px, 7.5vw, 72px);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  position:relative;
  transition:background 0.4s, box-shadow 0.2s, filter 0.2s;
  border-radius: var(--board-radius);
  font-size: clamp(1.8rem, 4vw, 2.8rem);
  user-select:none;
}
.cell.neutral { background: var(--neutral); }
.cell.p1 { background: var(--p1-light); }
.cell.p2 { background: var(--p2-light); }
.cell.selected { box-shadow:inset 0 0 0 3px var(--accent) !important; background:var(--accent-dim) !important; }
[data-theme="kiberfazo"] .cell.selected { box-shadow: inset 0 0 0 2px var(--accent), 0 0 15px var(--accent-dim) !important; }
[data-theme="rangbarang"] .cell.selected { box-shadow: inset 0 0 0 3px var(--accent), 0 0 12px var(--accent-dim) !important; }

.cell.valid-move::after {
  content:''; position:absolute;
  width:28%; height:28%;
  border-radius:50%;
  background: var(--accent);
  opacity: 0.6;
}
.cell.valid-capture::after {
  content:''; position:absolute; inset:0;
  border-radius: var(--board-radius);
  box-shadow:inset 0 0 0 3px var(--accent);
  opacity: 0.7;
}
.cell:hover:not(.selected) { filter:brightness(1.3); }
.piece {
  position:relative;
  z-index:2;
  line-height:1;
  font-family: 'Segoe UI', 'Arial Unicode MS', 'Noto Sans', sans-serif;
  font-weight: 400;
  display: inline-block;
  transform: scale(1);
  transition: transform 0.15s ease;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}
.cell:hover .piece { transform: scale(1.1); }

/* Beautiful chess piece styles */
.piece[data-piece="wK"] { 
  color: #f5e6d0; 
  text-shadow: 0 2px 4px rgba(0,0,0,0.4), 0 0 8px rgba(255,215,0,0.3);
}
.piece[data-piece="wQ"] { 
  color: #f5e6d0; 
  text-shadow: 0 2px 4px rgba(0,0,0,0.4), 0 0 8px rgba(255,215,0,0.3);
}
.piece[data-piece="wR"] { 
  color: #f5e6d0; 
  text-shadow: 0 2px 4px rgba(0,0,0,0.4);
}
.piece[data-piece="wB"] { 
  color: #f5e6d0; 
  text-shadow: 0 2px 4px rgba(0,0,0,0.4);
}
.piece[data-piece="wN"] { 
  color: #f5e6d0; 
  text-shadow: 0 2px 4px rgba(0,0,0,0.4);
}
.piece[data-piece="wP"] { 
  color: #f5e6d0; 
  text-shadow: 0 2px 4px rgba(0,0,0,0.4);
}

.piece[data-piece="bK"] { 
  color: #1a1a2e; 
  text-shadow: 0 2px 4px rgba(255,255,255,0.2);
}
.piece[data-piece="bQ"] { 
  color: #1a1a2e; 
  text-shadow: 0 2px 4px rgba(255,255,255,0.2);
}
.piece[data-piece="bR"] { 
  color: #1a1a2e; 
  text-shadow: 0 2px 4px rgba(255,255,255,0.2);
}
.piece[data-piece="bB"] { 
  color: #1a1a2e; 
  text-shadow: 0 2px 4px rgba(255,255,255,0.2);
}
.piece[data-piece="bN"] { 
  color: #1a1a2e; 
  text-shadow: 0 2px 4px rgba(255,255,255,0.2);
}
.piece[data-piece="bP"] { 
  color: #1a1a2e; 
  text-shadow: 0 2px 4px rgba(255,255,255,0.2);
}

[data-theme="klassika"] .piece[data-piece^="w"] { 
  background: linear-gradient(135deg, #f5e6d0, #e8dcc8);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
[data-theme="klassika"] .piece[data-piece^="b"] { 
  background: linear-gradient(135deg, #2a2a3a, #1a1a2e);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

[data-theme="akademiya"] .piece[data-piece^="w"] { 
  color: #2a1f0e;
  text-shadow: 0 1px 2px rgba(45,106,45,0.3);
}
[data-theme="akademiya"] .piece[data-piece^="b"] { 
  color: #4a3a2a;
  text-shadow: 0 1px 2px rgba(45,106,45,0.3);
}

[data-theme="kiberfazo"] .piece[data-piece^="w"] { 
  color: #00f5ff;
  text-shadow: 0 0 10px #00f5ff, 0 0 20px #00f5ff;
}
[data-theme="kiberfazo"] .piece[data-piece^="b"] { 
  color: #7b2fff;
  text-shadow: 0 0 10px #7b2fff, 0 0 20px #7b2fff;
}

[data-theme="chol"] .piece[data-piece^="w"] { 
  color: #f2ddb8;
  text-shadow: 0 2px 4px rgba(232,145,58,0.3);
}
[data-theme="chol"] .piece[data-piece^="b"] { 
  color: #9a7a50;
  text-shadow: 0 2px 4px rgba(232,145,58,0.3);
}

[data-theme="rangbarang"] .piece {
  font-weight: 700;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}
[data-theme="rangbarang"] .piece[data-piece^="w"] { color: #ffdd00; }
[data-theme="rangbarang"] .piece[data-piece^="b"] { color: #ff9f1c; }

[data-theme="kiberfazo"] .cell.p1 { box-shadow: inset 0 0 15px rgba(255,45,107,0.2); }
[data-theme="kiberfazo"] .cell.p2 { box-shadow: inset 0 0 15px rgba(0,195,255,0.2); }

.status-bar {
  width:100%; max-width:900px;
  text-align:center;
  font-family: var(--font-title);
  font-size:0.7rem;
  letter-spacing:0.12em;
  color:var(--text-dim);
  min-height:18px;
}

/* ===========================
   MODAL
   =========================== */
.modal-overlay {
  display:none;
  position:fixed; inset:0;
  background: var(--modal-bg);
  z-index:100;
  align-items:center;
  justify-content:center;
  backdrop-filter:blur(6px);
}
.modal-overlay.active { display:flex; }
.modal {
  background: var(--surface);
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:34px;
  max-width:540px;
  width:92%;
  position:relative;
  animation: modalIn 0.3s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes modalIn {
  from { transform:scale(0.88) translateY(24px); opacity:0; }
  to { transform:scale(1) translateY(0); opacity:1; }
}
.modal::before {
  content:'';
  position:absolute;
  top:-1px; left:10%; right:10%;
  height:2px;
  background:linear-gradient(90deg, transparent, var(--accent), transparent);
}
[data-theme="kiberfazo"] .modal { box-shadow: 0 0 60px rgba(0,245,255,0.1); }
[data-theme="rangbarang"] .modal { box-shadow: 0 20px 60px rgba(0,0,0,0.6); }

.modal-badge {
  font-family: var(--font-title);
  font-size:0.65rem;
  letter-spacing:0.22em;
  text-transform:uppercase;
  color:var(--accent);
  margin-bottom:14px;
  display:flex;
  align-items:center;
  gap:10px;
}
.modal-badge::before, .modal-badge::after { content:''; flex:1; height:1px; background:var(--border); }
.modal-question {
  font-size:1.15rem;
  line-height:1.65;
  color:var(--text);
  margin-bottom:22px;
  font-style:italic;
}
[data-theme="kiberfazo"] .modal-question { font-style: normal; letter-spacing: 0.02em; }
[data-theme="rangbarang"] .modal-question { font-style: normal; font-weight: 700; font-size: 1.1rem; }

.answer-options { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:18px; }
.answer-btn {
  padding:12px 14px;
  background: var(--surface2);
  border:1px solid var(--border);
  border-radius: var(--radius);
  color:var(--text);
  font-family: var(--font-body);
  font-size:0.98rem;
  cursor:pointer;
  transition:all 0.2s;
  text-align:left;
}
.answer-btn:hover { border-color:var(--accent); color:var(--accent2); background:var(--accent-dim); }
[data-theme="kiberfazo"] .answer-btn:hover { box-shadow: 0 0 12px rgba(0,245,255,0.15); }
[data-theme="rangbarang"] .answer-btn { font-weight: 700; font-size: 0.9rem; }
.answer-btn.correct { border-color: var(--success); background:rgba(var(--success-rgb,39,174,96),0.15); color: var(--success); }
.answer-btn.wrong { border-color:var(--fail); background:rgba(var(--fail-rgb,192,57,43),0.15); color:var(--fail); }
.answer-btn:disabled { cursor:default; }

.modal-result {
  text-align:center;
  font-family: var(--font-title);
  font-size:0.95rem;
  letter-spacing:0.07em;
  padding:12px;
  border-radius: var(--radius);
  display:none;
}
.modal-result.success { display:block; background:rgba(39,174,96,0.1); color:var(--success); border:1px solid rgba(39,174,96,0.3); }
.modal-result.fail { display:block; background:rgba(192,57,43,0.1); color:var(--fail); border:1px solid rgba(192,57,43,0.3); }
.modal-continue {
  display:none;
  width:100%;
  margin-top:14px;
  padding:13px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border:none;
  border-radius: var(--radius);
  color: var(--bg);
  font-family: var(--font-title);
  font-size:0.85rem;
  font-weight:700;
  letter-spacing:0.12em;
  text-transform:uppercase;
  cursor:pointer;
  transition: opacity 0.2s, transform 0.1s;
}
.modal-continue:hover { opacity:0.88; transform: translateY(-1px); }

/* ===========================
   END SCREEN
   =========================== */
#end-screen {
  min-height:100vh;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:40px 20px;
}
.end-card {
  text-align:center;
  max-width:500px;
  width:100%;
  background: var(--surface);
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:48px 38px;
  position:relative;
}
.end-card::before {
  content:'';
  position:absolute;
  top:-1px; left:10%; right:10%;
  height:2px;
  background:linear-gradient(90deg, transparent, var(--accent), transparent);
}
.end-title { font-family: var(--font-title); font-size:0.75rem; letter-spacing:0.28em; text-transform:uppercase; color:var(--text-dim); margin-bottom:14px; }
.end-winner {
  font-family: var(--font-title);
  font-size:clamp(1.7rem, 5vw, 2.7rem);
  font-weight:900;
  background:linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  background-clip: text;
  margin-bottom:8px;
}
.end-subtitle { color:var(--text-dim); font-size:1rem; margin-bottom:28px; font-style:italic; }
.end-scores { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:28px; }
.end-score-box { padding:18px; border-radius: var(--radius); }
.end-score-box.p1 { background:var(--p1-light); border:1px solid var(--p1); }
.end-score-box.p2 { background:var(--p2-light); border:1px solid var(--p2); }
.end-score-name { font-family: var(--font-title); font-size:0.8rem; color:var(--text-dim); margin-bottom:6px; }
.end-score-num { font-family: var(--font-title); font-size:2.4rem; font-weight:700; }
.p1 .end-score-num { color:var(--p1); }
.p2 .end-score-num { color:var(--p2); }
.end-score-label { font-size:0.75rem; color:var(--text-dim); }
.play-again-btn {
  padding:14px 36px;
  background:transparent;
  border:1px solid var(--accent);
  border-radius: var(--radius);
  color:var(--accent);
  font-family: var(--font-title);
  font-size:0.82rem;
  letter-spacing:0.14em;
  text-transform:uppercase;
  cursor:pointer;
  transition:all 0.3s;
}
.play-again-btn:hover { background:var(--accent-dim); box-shadow:0 0 20px var(--accent-dim); transform: translateY(-1px); }

/* ===========================
   KIBERFAZO SCANLINES
   =========================== */
[data-theme="kiberfazo"] #game-screen::after,
[data-theme="kiberfazo"] #setup-screen::after {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:200;
  background: repeating-linear-gradient(
    0deg,
    rgba(0,245,255,0.015) 0px,
    rgba(0,245,255,0.015) 1px,
    transparent 1px,
    transparent 3px
  );
}

/* ===========================
   AKADEMIYA PAPER TEXTURE
   =========================== */
[data-theme="akademiya"] .setup-card,
[data-theme="akademiya"] .board-container,
[data-theme="akademiya"] .modal,
[data-theme="akademiya"] .end-card {
  box-shadow: 0 4px 20px rgba(0,0,0,0.15), inset 0 0 0 1px rgba(45,106,45,0.1);
}
[data-theme="akademiya"] body {
  background-image: 
    repeating-linear-gradient(0deg, rgba(45,106,45,0.02) 0px, rgba(45,106,45,0.02) 1px, transparent 1px, transparent 28px);
}

/* ===========================
   RANGBARANG STARS
   =========================== */
[data-theme="rangbarang"] #setup-screen::before,
[data-theme="rangbarang"] #game-screen::before {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
  background-image:
    radial-gradient(1px 1px at 20% 30%, white 0%, transparent 100%),
    radial-gradient(1px 1px at 80% 10%, white 0%, transparent 100%),
    radial-gradient(1px 1px at 50% 70%, rgba(255,255,255,0.6) 0%, transparent 100%),
    radial-gradient(1px 1px at 10% 80%, rgba(255,255,255,0.4) 0%, transparent 100%),
    radial-gradient(1px 1px at 90% 60%, rgba(255,255,255,0.5) 0%, transparent 100%),
    radial-gradient(2px 2px at 30% 50%, rgba(255,221,0,0.4) 0%, transparent 100%),
    radial-gradient(2px 2px at 70% 90%, rgba(46,213,115,0.3) 0%, transparent 100%);
}
@media (orientation: landscape) and (max-height: 500px) {
  .game-header {
    font-size: 0.8rem;
  }
  
  .player-score {
    font-size: 1.2rem;
  }
  
  .timer-value {
    font-size: 1.2rem;
  }
  
  .board-container {
    padding: 8px;
  }
}

/* Large screens */
@media (min-width: 1400px) {
  :root {
    --board-size: 700px;
  }
  
  .cell {
    font-size: 45px;
  }
}

/* Print styles */
@media print {
  .theme-switcher,
  .modal-overlay,
  .start-btn,
  .play-again-btn {
    display: none !important;
  }
  
  body {
    background: white;
    color: black;
  }
}

</style>
</head>
<body>

<!-- SETUP SCREEN -->
<div id="setup-screen" class="screen active">
  <div class="logo">
    <div class="logo-title" id="logo-title">STRATEGIYA</div>
    <div class="logo-line"></div>
    <div class="logo-subtitle">Bilim Shaxmati · Harbiy Intellekt Dueli</div>
  </div>

  <!-- THEME SWITCHER -->
  <div class="theme-switcher">
    <div class="theme-item">
      <div class="theme-dot active" data-t="klassika" onclick="setTheme('klassika',this)" title="Oltin Klassika"></div>
      <div class="theme-label">Klassika</div>
    </div>
    <div class="theme-item">
      <div class="theme-dot" data-t="akademiya" onclick="setTheme('akademiya',this)" title="Yashil Akademiya"></div>
      <div class="theme-label">Akademiya</div>
    </div>
    <div class="theme-item">
      <div class="theme-dot" data-t="kiberfazo" onclick="setTheme('kiberfazo',this)" title="Kiberfazo"></div>
      <div class="theme-label">Kiberfazo</div>
    </div>
    <div class="theme-item">
      <div class="theme-dot" data-t="chol" onclick="setTheme('chol',this)" title="Qumli Cho'l"></div>
      <div class="theme-label">Cho'l</div>
    </div>
    <div class="theme-item">
      <div class="theme-dot" data-t="rangbarang" onclick="setTheme('rangbarang',this)" title="Rang-barang"></div>
      <div class="theme-label">Rang-barang</div>
    </div>
  </div>

  <div class="setup-card">
    <div class="setup-section">
      <span class="setup-label">O'yinchilar</span>
      <div class="player-row">
        <input class="player-input p1" id="p1-name" type="text" placeholder="1-o'yinchi (Qizil)" maxlength="20">
        <input class="player-input p2" id="p2-name" type="text" placeholder="2-o'yinchi (Ko'k)" maxlength="20">
      </div>
    </div>
    <div class="setup-section">
      <span class="setup-label">Vaqt chegarasi</span>
      <div class="time-options">
        <div class="time-btn" data-time="300">5 daq</div>
        <div class="time-btn selected" data-time="600">10 daq</div>
        <div class="time-btn" data-time="900">15 daq</div>
        <div class="time-btn" data-time="1200">20 daq</div>
      </div>
    </div>
    <button class="start-btn" onclick="startGame()">⚔ Jangni boshlash</button>
  </div>
</div>

<!-- GAME SCREEN -->
<div id="game-screen" class="screen">
  <div class="game-header">
    <div class="player-panel p1" id="panel-p1">
      <div class="player-label">Qizil qo'shin</div>
      <div class="player-name" id="name-p1">1-o'yinchi</div>
      <div class="player-score" id="score-p1">0</div>
      <div class="player-label">katakcha</div>
    </div>
    <div class="timer-display">
      <div class="timer-value" id="timer-display">10:00</div>
      <div class="timer-label">Qolgan vaqt</div>
      <div class="turn-indicator" id="turn-indicator">Navbat: —</div>
    </div>
    <div class="player-panel p2" id="panel-p2">
      <div class="player-label">Ko'k qo'shin</div>
      <div class="player-name" id="name-p2">2-o'yinchi</div>
      <div class="player-score" id="score-p2">0</div>
      <div class="player-label">katakcha</div>
    </div>
  </div>
  <div class="status-bar" id="status-bar">Yurish uchun figurani tanlang</div>
  <div class="board-container">
    <div id="chess-board"></div>
  </div>
</div>

<!-- END SCREEN -->
<div id="end-screen" class="screen">
  <div class="end-card">
    <div class="end-title">Jang yakunlandi</div>
    <div class="end-winner" id="end-winner">—</div>
    <div class="end-subtitle" id="end-subtitle">Bilim kuch — hududni nazorat qil</div>
    <div class="end-scores">
      <div class="end-score-box p1">
        <div class="end-score-name" id="end-name-p1">1-o'yinchi</div>
        <div class="end-score-num" id="end-num-p1">0</div>
        <div class="end-score-label">katakcha</div>
      </div>
      <div class="end-score-box p2">
        <div class="end-score-name" id="end-name-p2">2-o'yinchi</div>
        <div class="end-score-num" id="end-num-p2">0</div>
        <div class="end-score-label">katakcha</div>
      </div>
    </div>
    <button class="play-again-btn" onclick="resetGame()">↩ Yangi jang</button>
  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <div class="modal-badge">Bilim sinovi</div>
    <div class="modal-question" id="modal-question">Savol yuklanmoqda...</div>
    <div class="answer-options" id="answer-options"></div>
    <div class="modal-result" id="modal-result"></div>
    <button class="modal-continue" id="modal-continue" onclick="continueAfterAnswer()">Davom etish</button>
  </div>
</div>

<script>
// ===== THEME =====
let currentTheme = 'klassika';
function setTheme(t, dotEl) {
  currentTheme = t;
  document.documentElement.setAttribute('data-theme', t);
  document.querySelectorAll('.theme-dot').forEach(d => d.classList.remove('active'));
  if(dotEl) dotEl.classList.add('active');
}
setTheme('klassika', document.querySelector('.theme-dot[data-t="klassika"]'));

// ===== SAVOLLAR (unchanged) =====
const QUESTIONS = [
 // --- NAFTANDOZ ---
  { q:"'Naftandoz' qadimgi janglarda qanday vazifani bajargan?", options:["Olovli qurol otuvchi jangchi","Suv ta'minotchi","Razvedkachi","Ot minuvchi jangchi"], correct:0 },
  { q:"Qadimgi harbiy texnikada 'naft' nima maqsadda ishlatilgan?", options:["Dushman saflarini olov bilan sindirish","Oziq-ovqat pishirish","Ko'prik qurish","Shifobaxsh maqsadlarda"], correct:0 },

  // --- QAL'A BUZUVCHI ---
  { q:"'Qal'a buzuvchi' qo'shinlarda qanday texnikadan foydalangan?", options:["Qo'chqor (taran) va katapulta","Ot aravasi","Kamon va o'q","Zirh va qalqon"], correct:0 },
  { q:"O'rta asrlarda qal'alarni zabt etishda qaysi usul eng keng tarqalgan edi?", options:["Uzoq muddatli qamal","To'g'ridan-to'g'ri hujum","Tungi reyd","Yashirin o'tish"], correct:0 },
  { q:"'Fil hujumiga qarshi usul' qaysi davlat qo'shinlarida keng qo'llanilgan?", options:["Qadimgi Hindiston va Fors","Rim imperiyasi","Mo'g'ul imperiyasi","Vizantiya"], correct:0 },

  // --- MANJANIQ ---
  { q:"'Manjaniq' nima?", options:["Og'ir toshlarni uzoqqa otuvchi qadimgi jangovar mashina","Qal'a darvozasi","Harbiy ot aravaси","Zirh turi"], correct:0 },
  { q:"'Tuzoq (qopqon)' harbiy strategiyada nimani anglatadi?", options:["Dushmanni rejalashtirilgan joyga jalb qilib mag'lub etish","Chekinish yo'lini yopish","Qal'a mudofaasi","Otliqlar hujumi"], correct:0 },
  { q:"'Arqon' janglarda qanday maqsadda ishlatilgan?", options:["Dushman otliqlarini to'xtatish va qo'lga olish","Ko'prik qurishda","Qal'a devorini buzishda","Signal berish uchun"], correct:0 },
  { q:"'Intizom' harbiy jihatdan nimani bildiradi?", options:["Qo'shin saflarida tartib va bo'ysunishni saqlash","Qurol turlari","Jang taktikasi","Mudofaa chizig'i"], correct:0 },
  { q:"'Javan-g'ar' harbiy atama sifatida nimani anglatadi?", options:["Qo'shinning old safidagi bo'linma — avangard","Zahira bo'linmasi","Ot-otliq qism","Mudofaa chizig'i"], correct:0 },
  { q:"'Izmir qamali' tarixda qaysi voqea bilan bog'liq?", options:["O'rta asr musulmon va xristian qo'shinlari o'rtasidagi qamal","Mo'g'ul istilosi","Rim-Fors urushi","Turklar hujumi"], correct:1 },
  { q:"'Said Baraka' — bu qaysi sohaga oid tushuncha?", options:["Harbiy rahbar yoki ma'naviy lider","Qurol turi","Jang maydoni","Mudofaa inshooti"], correct:0 },

  // --- MUHANDIS ---
  { q:"Qo'shindagi 'muhandis' qanday vazifa bajaradi?", options:["Ko'prik, yo'l, istehkom qurish va buzish","Faqat qurol tayyorlash","Razvedka olib borish","Tibbiy yordam ko'rsatish"], correct:0 },
  { q:"'Chekinish usuli' strategiyada nimani anglatadi?", options:["Dushmanни cho'zib, kuchdan qoldirish uchun ataylab chekinish","Mag'lubiyatni tan olish","Mudofaaga o'tish","Qal'aga yashirinish"], correct:0 },
  { q:"'Qalqon' janglarda asosiy qanday vazifani bajargan?", options:["Zarba va o'qlardan himoya qilish","Hujum quroli sifatida","Signal berish uchun","Bayroq sifatida"], correct:0 },
  { q:"'Barut' harbiy tarixda qanday inqilob yaratdi?", options:["O't o'q qurollarini vujudga keltirdi va qal'alar ahamiyatini kamaytirdi","Otliqlar ustunligini mustahkamladi","Dengiz janglari yo'q oldi","Harbiy muhandislik rivojini to'xtatdi"], correct:0 },
  { q:"'Baran-g'ar' atamasi nimani bildiradi?", options:["Qo'shinning o'ng qanotidagi bo'linma","Mudofaa inshooti","Otliqlar rotasii","Zahira qo'shin"], correct:0 },
  { q:"'Anqara jangi' qaysi yilda bo'lib o'tgan?", options:["1402","1453","1299","1389"], correct:0 },
  { q:"'Zafarnoma' — bu qaysi buyuk sarkardaning asari?", options:["Amir Temur","Napoleon","Xitoy imperatori","Hannibal"], correct:0 },
  { q:"'Yuzboshi' — bu harbiy unvon sifatida nechta jangchini boshqaruvchini anglatadi?", options:["100 ta jangchini","10 ta jangchini","1000 ta jangchini","50 ta jangchini"], correct:0 },

  // --- SUVORIY ---
  { q:"'Suvoriy' qo'shinlarda qanday rол o'ynagan?", options:["Tez harakatlanuvchi ot mingan jangchi","Piyoda askar","Qamal mutaxassisi","Razvedkachi"], correct:0 },
  { q:"'Tungi hujum' taktikasi qanday afzalliklarga ega?", options:["Dushmanni g'aflatda qoldirish va vahima uyg'otish","Ko'proq askar jalb qilish","Qurollardan yaxshiroq foydalanish","Mudofaani mustahkamlash"], correct:0 },
  { q:"'Sovut' nima?", options:["Askar tanasini himoya qiluvchi zirh","Hujum quroli","Otliq bo'linma","Signal vositasi"], correct:0 },
  { q:"'Qo'shin ta'minoti' harbiy logistikada nimani anglatadi?", options:["Qo'shinga oziq-ovqat, qurol va zarur ashyolarni yetkazib berish","Jangchilarni tayyorlash","Razvedka ma'lumotlarini to'plash","Muloqot va signal tizimi"], correct:0 },
  { q:"'G'ul (Shaxsiy qo'riqchilar)' qo'shinda qanday vazifani bajaradi?", options:["Sarkarda yoki hukmdorni shaxsiy muhofaza qilish","Old saf jangini olib borish","Razvedka missiyasi","Qurol ta'mirchilar guruh"], correct:0 },
  { q:"'Dehli yurishi' tarixda qaysi sarkarda nomi bilan bog'liq?", options:["Amir Temur","Chingizxon","Bobur","Nod Muhammad"], correct:0 },
  { q:"'Ot tanlash tartibi' qadimgi qo'shinlarda nima uchun muhim edi?", options:["Jang uchun eng kuchli va bardoshli otlarni tanlash","Safar paytida ovqat zaxirasini hisoblash","Qo'shinni taqsimlash","Lager o'rnatish joyin belgilash"], correct:0 },
  { q:"'Mingboshi' — bu harbiy unvon sifatida nechta jangchini boshqaradi?", options:["1000 ta jangchini","100 ta jangchini","10 ta jangchini","10000 ta jangchini"], correct:0 },

  // --- KAMONCHI ---
  { q:"'Kamonchi' qo'shinlarda qanday ustunlik bergan?", options:["Uzoq masofadan dushman saflarini sindirish","Qal'a devorini buzish","Razvedka olib borish","Dushman otlarini egallash"], correct:0 },
  { q:"'Pistirma' harbiy strategiyada nimani anglatadi?", options:["Dushmanни mo'ljallangan joyda kutib, g'aflatda hujum qilish","Mudofaa chizig'i","Chekinish tartibi","Qo'shin tartibini o'zgartirish"], correct:0 },
  { q:"'Gurzi' qadimgi janglarda qanday qurol?", options:["Og'ir metall bosh qismi bo'lgan qo'l quroli","Uzoq masofali o'q otadigan qurol","Otliq bo'linma uchun nayzasi","Zirh turi"], correct:0 },
  { q:"'Joy tanlash (pozitsiya)' strategiyasida nimani hisobga olish kerak?", options:["Baland joy, quyosh tomoni, suv manbai va chekinish yo'llari","Faqat dushman soni","Qurol miqdori","Yil fasli"], correct:0 },
  { q:"'Nog'orachilar' qadimgi qo'shinlarda qanday rol o'ynagan?", options:["Nog'ora chalib signal berish va jangchilar ruhini ko'tarish","Meditsina xizmati","Qurol tayyorlash","Qal'a qurish"], correct:0 },
  { q:"'Qunduz6 jangi' qaysi davr va mintaqaga oid?", options:["O'rta Osiyo harbiy tarixi — Qunduz shahri atrofidagi janglar","Qadimgi Rim janglar","O'rta asr Yevropa","Mo'g'ullar istilosigacha"], correct:0 },
  { q:"'Mahmud Taybodiy' kim bo'lgan?", options:["O'rta Osiyo harbiy tarixidagi taniqli shaxs","Yunon faylasufi","Rim sarkardasi","Xitoy imperatori"], correct:0 },
  { q:"'Tumanboshi' — bu unvon nechta jangchiga boshchilik qilishni anglatadi?", options:["10 000 jangchi","1 000 jangchi","100 jangchi","100 000 jangchi"], correct:0 },

  // --- PIYODALAR ---
  { q:"'Piyoda askar' qo'shinda qanday asosiy vazifani bajaradi?", options:["Jang maydonini to'g'ridan-to'g'ri nazorat qilish","Uzoq masofali o'q otish","Ot ustida hujum","Qamal ishlarini boshqarish"], correct:0 },
  { q:"'To'siqdan o'tish' harbiy operatsiyada nimani anglatadi?", options:["Daryo, qal'a yoki tabiiy to'siqni yengib o'tish usullari","Mudofaa tizimini mustahkamlash","Qo'shin tartibini o'zgartirish","Razvedka olib borish"], correct:0 },
  { q:"'O'q-yoy' qaysi davr qo'shinlarida eng asosiy uzoq masofali qurol hisoblangan?", options:["Qadimgi va o'rta asrlar davri qo'shinlarida","Faqat mo'g'ul qo'shinlarida","Faqat o'rta asr Yevropa qo'shinlarida","Faqat Turkiy xonliklarida"], correct:0 },
  { q:"'Josuslik (razvedka)' harbiy jihatdan qanday ahamiyatga ega?", options:["Dushman kuchi, joylashuvi va niyati haqida oldindan ma'lumot to'plash","Qo'shinga oziq-ovqat ta'minoti","Istehkom qurish","Signal tizimini boshqarish"], correct:0 },
  { q:"'Bayroqdirlar' qo'shinda qanday vazifani bajargan?", options:["Bayroq ko'tarib ruhni ko'tarish va qo'shinni yo'naltirish","Hujumda birinchi saf","Mudofaada oxirgi saf","Razvedka guruhi"], correct:0 },
  { q:"'Terek jangi' (1395) kim bilan kim o'rtasida bo'lgan?", options:["Amir Temur va To'xtamish xon o'rtasida","Chingizxon va Xorazmshoh o'rtasida","Bobur va Lodi sulola o'rtasida","Sohibqiron va Usmon sultoni o'rtasida"], correct:0 },
  { q:"'Mashvarat (maslahat)' harbiy qaror qabul qilishda qanday rol o'ynaydi?", options:["Tajribali sarkardalar va maslahatchilar bilan birgalikda eng to'g'ri strategiyani ishlab chiqish","Faqat bosh sarkarda buyrug'ini bajarish","Dushman bilan muzokaralar olib borish","Qo'shin tartibini tekshirish"], correct:0 },
  { q:"'Amir' — bu unvon harbiy ierarxiyada nimani bildiradi?", options:["Harbiy boshliq, qo'mondon yoki yuqori martabali rahbar","Oddiy askar","Razvedkachi","Muhandis"], correct:0 },

  // --- IZOFA ---
  { q:"'Izofa' — bu grammatik tushuncha, lekin harbiy terminologiyada qanday ishlatiladi?", options:["Nom va sifatni bog'lash, masalan 'Amir Temur' — amir + ismi","Harbiy bo'linma nomi","Qurol turi","Jang taktikasi"], correct:0 },
  { q:"'Qamal san'ati' nima?", options:["Qal'a yoki shaharni qamal qilib zabt etish strategiyasi va taktikasi","Razvedka usullari","Otliqlar harakati","Mudofaa inshooti qurish"], correct:0 },
  { q:"'Qilich' qanday qurol turiga kiradi?", options:["Yaqin masofali kesuvchi va sanqituvchi qurol","Uzoq masofali qurol","Og'ir zirhli qurol","Otliq uchun maxsus qurol"], correct:0 },
  { q:"'Ruhiy bosim (Dahshat solish)' strategiyada qanday maqsadda ishlatilgan?", options:["Dushman ruhini sindirish va taslim bo'lishga undash","Qo'shin tartibini mustahkamlash","Razvedka ma'lumotlarini to'plash","Mudofaani kuchaytirish"], correct:0 },
  { q:"'Markaz (Qalb)' jang tartibida nimani anglatadi?", options:["Qo'shinning o'rta asosiy qismi — eng muhim taktik element","Qo'mondon joylashgan joy","Zahira bo'linmasi","Old saf otliq qismi"], correct:0 },
  { q:"'Loy jangi' harbiy tarixda nima uchun muhim?", options:["Loy va botqoq jang maydoni taktik harakatlarni qiyinlashtiradi","Loy mudofaa inshooti sifatida","Loy ko'prik qurishda ishlatilgan","Loy qurol saqlashda zarur"], correct:0 },
  { q:"'Kuchadolatda' — bu ibora harbiy kontekstda nimani anglatadi?", options:["Ko'cha va shahar ko'chamlarida qo'shinlar bilan olib boriladigan shahar jangi","Ochiq maydondagi jang","Suv ustidagi jang","Tungi operatsiya"], correct:0 },
  { q:"'Tuzuklar' — bu qaysi buyuk hukmdorning asari?", options:["Amir Temurning harbiy va davlat boshqaruvi qoidalari to'plami","Chingizxonning qonunlar to'plami","Atobeklarning farmonnomasi","Somoniylar davlat nizomi"], correct:0 },

  // --- HIRAVUL ---
  { q:"'Hiravul' harbiy terminologiyada nimani anglatadi?", options:["Qo'shinning eng oldingi — avangard — bo'linmasi","Zahira qo'shin","Bosh qo'mondon muhofazasi","Signal bo'linmasi"], correct:0 },
  { q:"'Xitoy safari' tarixda Amir Temurning qaysi niyati bilan bog'liq?", options:["Temurning Xitoyga yurish rejalashtirgani, lekin vafoti sababli amalga oshmay qolgan yurish","Chingizxonning Xitoyni zabt etishi","Mo'g'ullarning Xitoy istilosi","Ming sulolasining g'arbga yurishi"], correct:0 },
  { q:"'Ko'ragon' — bu unvon nima ma'noni anglatadi?", options:["Mo'g'ul xonlari sulolasi bilan qarindosh bo'lgan hukmdorlar unvoni","Oddiy jangchi unvoni","Qurol ustasi","Harbiy muhandis"], correct:0 },
  { q:"'Jasorat' jangda qanday ahamiyatga ega?", options:["Xavf-xatardan qo'rqmaslik, jangda g'ayrat va qat'iyat ko'rsatish","Tez chekinish mahorati","Yashirincha harakat qilish","Raqibni aldash san'ati"], correct:0 },
  { q:"'Nayza' qaysi qurol turiga kiradi?", options:["Uzoq sopli uchli harbiy qurol — piyoda va otliqlar uchun","Kesuvchi qilich turi","Uloqtiriladigan qurol","Mudofaa qalqoni"], correct:0 },
  { q:"'Ra'gbat' — jangchilarni rag'batlantirish qanday usullarda amalga oshirilgan?", options:["O'lja va'da qilish, unvon berish, e'tirof etish","Jazolash tahdidi","Faqat pul to'lash","Qurol berish"], correct:0 },
  { q:"'Qanbul' — bu qaysi harbiy atama?", options:["Strategik muhim hudud yoki o'tish nuqtasi","Qurol turi","Jang tartibi","Mudofaa inshootining bir qismi"], correct:0 },
  { q:"'Yetti yillik yurish' qaysi sarkarda bilan bog'liq?", options:["Amir Temurning G'arbga 7 yillik harbiy yurishi (1399-1404)","Iskandarning Sharqqa yurishi","Chingizxonning g'arbga yurishi","Napoleonning Rossiyaga yurishi"], correct:0 },
  { q:"'Turkning bosh bo'g'ini' iborasi harbiy-tarixiy kontekstda nimani anglatadi?", options:["Turkiy harbiy kuchning asosi va markaziy rahbarlik tizimi","Qurol turi","Jang taktikasi","Mudofaa inshootlari"], correct:0 },
  { q:"'Yasoq' — Chingizxon yaratgan yasoq (Yasa) qanday hujjat?", options:["Mo'g'ul imperiyasining harbiy va fuqarolik qonunlar to'plami","Faqat harbiy nizom","Soliq to'lash qoidalari","Savdo shartnomasi"], correct:0 },
  { q:"'Sopqon-tosh' nima?", options:["Dushman saflariga tosh otib sindirish uchun ishlatiladigan mancineq o'q-dori","Qurol turi","Qal'a materiali","Suv o'tkazgich"], correct:0 },
  { q:"'Jazo' harbiy intizom tizimida qanday rol o'ynagan?", options:["Qo'shin tartibini saqlash va bo'ysunmaslikni oldini olish vositasi","Dushman bilan muzokaralar","Qo'shinni birlashtirish","Jangchilarni tanlash usuli"], correct:0 },
  { q:"'O'nboshi' — bu unvon nechta jangchini boshqarishni anglatadi?", options:["10 ta jangchini","5 ta jangchini","100 ta jangchini","50 ta jangchini"], correct:0 },

  // QO'SHIMCHA UMUMIY SAVOLLAR
  { q:"Mo'g'ul qo'shinlarida asosiy harbiy taktika qanday edi?", options:["Tez otliq harakatlanish va yoy o'qi bilan uzoq masofali hujum","Piyoda jangchilar bilan to'g'ridan-to'g'ri hujum","Qal'alar qurib mudofaa","Kema janglar"], correct:0 },
  { q:"Amir Temur qo'shinining asosiy kuchi nimadan iborat edi?", options:["Og'ir qurollangan otliqlar va mohir o'q otuvchilar","Faqat piyoda askarlar","Fil qo'shini","Dengiz kuchlari"], correct:0 },
  { q:"'Strategiya' so'zi qaysi tildan kelib chiqqan?", options:["Yunon tilidan — 'stratos' (qo'shin) + 'agein' (boshqarmoq)","Lotin tilidan","Arab tilidan","Fors tilidan"], correct:0 },
  { q:"Qadimgi Xitoy harbiy traktatida 'O'zingni bil, dushmaningni bil' iborasi qaysi asarda keltirilgan?", options:["Sun-Szining 'Urush san'ati' asarida","Klauzevitzning 'Urush haqida' asarida","Makiavellining 'Shoh' asarida","Amir Temurning 'Tuzuklari'da"], correct:0 },
  { q:"'Taktika' va 'strategiya' o'rtasidagi farq nima?", options:["Taktika — alohida jang usullari, strategiya — umumiy urush rejasi","Ular bir xil tushuncha","Taktika — uzoq muddatli, strategiya — qisqa muddatli","Taktika — quruqlikda, strategiya — dengizda"], correct:0 },
  { q:"O'rta asrlarda 'Silk Road' (Buyuk Ipak yo'li) harbiy jihatdan qanday ahamiyat kasb etgan?", options:["Harbiy kuchlarni tez ko'chirish va harbiy ma'lumot uzatish yo'li bo'lgan","Faqat tijorat maqsadida ishlatilgan","Faqat diplomatik aloqalarda","Qishloq xo'jaligi uchun"], correct:0 },
];

// ===== CHESS ENGINE =====
// Beautiful chess piece icons (Unicode chess symbols)
const PIECES = {
  wK:'♔', wQ:'♕', wR:'♖', wB:'♗', wN:'♘', wP:'♙',
  bK:'♚', bQ:'♛', bR:'♜', bB:'♝', bN:'♞', bP:'♟',
};

function initBoard() {
  const b = Array(8).fill(null).map(()=>Array(8).fill(null));
  b[0]=['bR','bN','bB','bQ','bK','bB','bN','bR'];
  b[1]=['bP','bP','bP','bP','bP','bP','bP','bP'];
  b[6]=['wP','wP','wP','wP','wP','wP','wP','wP'];
  b[7]=['wR','wN','wB','wQ','wK','wB','wN','wR'];
  return b;
}
let board=initBoard(), cellOwner=Array(8).fill(null).map(()=>Array(8).fill(null));
let currentPlayer='p1', selectedCell=null, validMoves=[], timerSeconds=600;
let timerInterval=null, gameActive=false, pendingMove=null;
let playerNames={p1:"1-o'yinchi", p2:"2-o'yinchi"};
let questionPool=[...QUESTIONS].sort(()=>Math.random()-0.5), questionIndex=0;

function getQuestion(){
  if(questionIndex>=questionPool.length){questionPool=[...QUESTIONS].sort(()=>Math.random()-0.5);questionIndex=0;}
  return questionPool[questionIndex++];
}

document.querySelectorAll('.time-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.time-btn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
  });
});

function startGame(){
  const p1=document.getElementById('p1-name').value.trim()||"1-o'yinchi";
  const p2=document.getElementById('p2-name').value.trim()||"2-o'yinchi";
  playerNames={p1,p2};
  const tb=document.querySelector('.time-btn.selected');
  timerSeconds=parseInt(tb?.dataset.time||600);
  board=initBoard(); cellOwner=Array(8).fill(null).map(()=>Array(8).fill(null));
  currentPlayer='p1'; selectedCell=null; validMoves=[]; pendingMove=null;
  questionIndex=0; questionPool=[...QUESTIONS].sort(()=>Math.random()-0.5);
  gameActive=true;
  document.getElementById('name-p1').textContent=p1;
  document.getElementById('name-p2').textContent=p2;
  showScreen('game-screen'); renderBoard(); updateHeader(); startTimer();
}

function showScreen(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');}

function startTimer(){
  clearInterval(timerInterval); updateTimerDisplay();
  timerInterval=setInterval(()=>{timerSeconds--;updateTimerDisplay();if(timerSeconds<=0){clearInterval(timerInterval);endGame();}},1000);
}
function updateTimerDisplay(){
  const m=Math.floor(timerSeconds/60),s=timerSeconds%60;
  document.getElementById('timer-display').textContent=`${m}:${s.toString().padStart(2,'0')}`;
  const el=document.getElementById('timer-display');
  if(timerSeconds<=60) el.style.color='#e74c3c';
  else if(timerSeconds<=180) el.style.color='#e67e22';
  else el.style.color='var(--accent)';
}
function updateHeader(){
  const sc=countScores();
  document.getElementById('score-p1').textContent=sc.p1;
  document.getElementById('score-p2').textContent=sc.p2;
  document.getElementById('panel-p1').classList.toggle('active',currentPlayer==='p1');
  document.getElementById('panel-p2').classList.toggle('active',currentPlayer==='p2');
  document.getElementById('turn-indicator').textContent=`Navbat: ${currentPlayer==='p1'?playerNames.p1:playerNames.p2}`;
}
function countScores(){let p1=0,p2=0;for(let r=0;r<8;r++)for(let c=0;c<8;c++){if(cellOwner[r][c]==='p1')p1++;else if(cellOwner[r][c]==='p2')p2++;}return{p1,p2};}

function renderBoard(){
  const el=document.getElementById('chess-board'); el.innerHTML='';
  for(let r=0;r<8;r++) for(let c=0;c<8;c++){
    const cell=document.createElement('div');
    cell.className='cell';
    cell.classList.add(cellOwner[r][c]||'neutral');
    if(selectedCell&&selectedCell[0]===r&&selectedCell[1]===c) cell.classList.add('selected');
    if(validMoves.some(([vr,vc])=>vr===r&&vc===c)) cell.classList.add(board[r][c]?'valid-capture':'valid-move');
    const piece=board[r][c];
    if(piece){
      const sp=document.createElement('span'); 
      sp.className='piece'; 
      sp.textContent=PIECES[piece];
      sp.setAttribute('data-piece', piece);
      cell.appendChild(sp);
    }
    cell.addEventListener('click',()=>onCellClick(r,c));
    el.appendChild(cell);
  }
}

function onCellClick(r,c){
  if(!gameActive) return;
  const piece=board[r][c];
  const isMine=piece&&((currentPlayer==='p1'&&piece[0]==='w')||(currentPlayer==='p2'&&piece[0]==='b'));
  if(selectedCell&&validMoves.some(([vr,vc])=>vr===r&&vc===c)){initiateMove(selectedCell[0],selectedCell[1],r,c);return;}
  if(isMine){selectedCell=[r,c];validMoves=getLegalMoves(r,c,board);setStatus(`${PIECES[piece]} tanlandi — katakcha tanlang`);}
  else{selectedCell=null;validMoves=[];setStatus("O'z figurangizni tanlang");}
  renderBoard();
}
function setStatus(m){document.getElementById('status-bar').textContent=m;}
function initiateMove(fr,fc,tr,tc){pendingMove={fr,fc,tr,tc};showModal(getQuestion());}

function showModal(q){
  document.getElementById('modal-question').textContent=q.q;
  const opts=document.getElementById('answer-options'); opts.innerHTML='';
  const sh=q.options.map((o,i)=>({text:o,idx:i})).sort(()=>Math.random()-0.5);
  sh.forEach(({text,idx})=>{
    const btn=document.createElement('button'); btn.className='answer-btn'; btn.textContent=text;
    btn.addEventListener('click',()=>checkAnswer(idx===q.correct,btn,sh,q.correct));
    opts.appendChild(btn);
  });
  document.getElementById('modal-result').className='modal-result';
  document.getElementById('modal-result').textContent='';
  document.getElementById('modal-continue').style.display='none';
  document.getElementById('modal').classList.add('active');
}
function checkAnswer(isCorrect,clickedBtn,sh,correctIdx){
  document.querySelectorAll('.answer-btn').forEach(b=>b.disabled=true);
  document.querySelectorAll('.answer-btn').forEach((b,i)=>{if(sh[i].idx===correctIdx)b.classList.add('correct');});
  if(!isCorrect) clickedBtn.classList.add('wrong');
  const re=document.getElementById('modal-result');
  if(isCorrect){re.className='modal-result success';re.textContent="✓ To'g'ri! Yurish hisoblanadi. Katakcha egallanadi.";}
  else{re.className='modal-result fail';re.textContent="✗ Noto'g'ri. Yurish bekor qilindi. Navbat raqibga o'tadi.";}
  document.getElementById('modal-continue').dataset.correct=isCorrect?'1':'0';
  document.getElementById('modal-continue').style.display='block';
}
function continueAfterAnswer(){
  const ok=document.getElementById('modal-continue').dataset.correct==='1';
  document.getElementById('modal').classList.remove('active');
  if(ok&&pendingMove){
    const{fr,fc,tr,tc}=pendingMove;
    board[tr][tc]=board[fr][fc]; board[fr][fc]=null;
    if(board[tr][tc]==='wP'&&tr===0) board[tr][tc]='wQ';
    if(board[tr][tc]==='bP'&&tr===7) board[tr][tc]='bQ';
    cellOwner[tr][tc]=currentPlayer;
    setStatus(`Yurish muvaffaqiyatli! ${playerNames[currentPlayer]} katakchani egalladi.`);
  } else {
    setStatus(`Noto'g'ri javob. Navbat ${currentPlayer==='p1'?playerNames.p2:playerNames.p1} ga o'tadi.`);
  }
  const w=checkGameOver(); if(w){endGame(w);return;}
  currentPlayer=currentPlayer==='p1'?'p2':'p1';
  selectedCell=null; validMoves=[]; pendingMove=null;
  renderBoard(); updateHeader();
}
function checkGameOver(){let wK=false,bK=false;for(let r=0;r<8;r++)for(let c=0;c<8;c++){if(board[r][c]==='wK')wK=true;if(board[r][c]==='bK')bK=true;}if(!wK)return'p2';if(!bK)return'p1';return null;}
function endGame(wo){
  gameActive=false; clearInterval(timerInterval);
  const sc=countScores(); let w=wo;
  if(!w){if(sc.p1>sc.p2)w='p1';else if(sc.p2>sc.p1)w='p2';else w='draw';}
  document.getElementById('end-name-p1').textContent=playerNames.p1;
  document.getElementById('end-name-p2').textContent=playerNames.p2;
  document.getElementById('end-num-p1').textContent=sc.p1;
  document.getElementById('end-num-p2').textContent=sc.p2;
  if(w==='draw'){document.getElementById('end-winner').textContent='Durrang!';document.getElementById('end-subtitle').textContent='Bilim va strategiyada tenglik';}
  else{document.getElementById('end-winner').textContent=playerNames[w];document.getElementById('end-subtitle').textContent=wo?`Shoh mat — mutlaq g'alaba!`:`${sc[w]} katakcha — hudud nazorati`;}
  setTimeout(()=>showScreen('end-screen'),600);
}
function resetGame(){clearInterval(timerInterval);showScreen('setup-screen');}

function getLegalMoves(r,c,b){
  const piece=b[r][c]; if(!piece)return[];
  const t=piece[1],co=piece[0],moves=[];
  const inB=(r,c)=>r>=0&&r<8&&c>=0&&c<8;
  const isE=(r,c)=>inB(r,c)&&b[r][c]&&b[r][c][0]!==co;
  const emp=(r,c)=>inB(r,c)&&!b[r][c];
  const cG=(r,c)=>inB(r,c)&&(!b[r][c]||b[r][c][0]!==co);
  const sl=(dr,dc)=>{let nr=r+dr,nc=c+dc;while(inB(nr,nc)){if(b[nr][nc]){if(isE(nr,nc))moves.push([nr,nc]);break;}moves.push([nr,nc]);nr+=dr;nc+=dc;}};
  if(t==='P'){const d=co==='w'?-1:1,sr=co==='w'?6:1;if(emp(r+d,c)){moves.push([r+d,c]);if(r===sr&&emp(r+2*d,c))moves.push([r+2*d,c]);}if(isE(r+d,c-1))moves.push([r+d,c-1]);if(isE(r+d,c+1))moves.push([r+d,c+1]);}
  else if(t==='R'){[[-1,0],[1,0],[0,-1],[0,1]].forEach(([dr,dc])=>sl(dr,dc));}
  else if(t==='B'){[[-1,-1],[-1,1],[1,-1],[1,1]].forEach(([dr,dc])=>sl(dr,dc));}
  else if(t==='Q'){[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]].forEach(([dr,dc])=>sl(dr,dc));}
  else if(t==='N'){[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(([dr,dc])=>{if(cG(r+dr,c+dc))moves.push([r+dr,c+dc]);});}
  else if(t==='K'){
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(([dr,dc])=>{if(cG(r+dr,c+dc))moves.push([r+dr,c+dc]);});
    if(co==='w'&&r===7&&c===4){if(b[7][7]==='wR'&&!b[7][5]&&!b[7][6])moves.push([7,6]);if(b[7][0]==='wR'&&!b[7][1]&&!b[7][2]&&!b[7][3])moves.push([7,2]);}
    if(co==='b'&&r===0&&c===4){if(b[0][7]==='bR'&&!b[0][5]&&!b[0][6])moves.push([0,6]);if(b[0][0]==='bR'&&!b[0][1]&&!b[0][2]&&!b[0][3])moves.push([0,2]);}
  }
  return moves;
}
</script>
</body>
</html>